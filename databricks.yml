bundle:
  name: customer-lapse-ml

workspace:
  host: ${env.DATABRICKS_HOST}

targets:
  dev:
    default: true
    mode: development
    variables:
      catalog: ${env.UC_CATALOG}
      schema: ${env.UC_SCHEMA_DEV}
  prod:
    mode: production
    variables:
      catalog: ${env.UC_CATALOG}
      schema: ${env.UC_SCHEMA_PROD}

variables:
  catalog: main
  schema: default

resources:
  jobs:
    train_lapse_model:
      name: "${bundle.name} - Train (${var.schema})"
      tasks:
        - task_key: train
          python_wheel_task:
            package_name: customer_lapse_ml
            entry_point: train
            parameters: ["--register", "--experiment", "/Shared/${bundle.name}/experiments/${var.schema}"]
          libraries:
            - pypi: { package: "-r requirements.txt" }
          job_cluster_key: single_node
      job_clusters:
        - job_cluster_key: single_node
          new_cluster:
            spark_version: 13.3.x-scala2.12
            node_type_id: Standard_DS3_v2
            num_workers: 0
            spark_conf:
              spark.master: local[*]
      permissions:
        - level: CAN_MANAGE
          user_name: ${env.CI_ACTOR:-""}

artifacts:
  wheel:
    type: python_wheel
    path: .
    build: { package_name: customer_lapse_ml }
